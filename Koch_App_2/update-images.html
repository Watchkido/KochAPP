<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Bilder zu bestehenden Rezepten hinzufügen</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/sql-wasm.js"></script>
    <script src="recipe-db.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .btn { padding: 10px 20px; margin: 10px; cursor: pointer; }
        .primary { background: #007bff; color: white; border: none; }
        .danger { background: #dc3545; color: white; border: none; }
        pre { background: #f5f5f5; padding: 15px; border-radius: 5px; max-height: 400px; overflow: auto; }
    </style>
</head>
<body>
    <h1>Datenbank-Update: Bilder hinzufügen</h1>
    
    <div>
        <button class="btn primary" onclick="updateImages()">Bilder zu Rezepten hinzufügen</button>
        <button class="btn danger" onclick="clearAndReload()">LocalStorage löschen & neu laden</button>
    </div>
    
    <pre id="output">Warte auf Aktion...</pre>

    <script>
        // Mapping von Rezepttiteln zu Bildpfaden
        const imageMapping = {
            "Hackbraten": "images/hackbraten.jpg",
            "Rührei mit Toast": "images/eier.jpg",
            "Käse-Toast": "images/burger.jpg",
            "Nudeln mit Pesto": "images/nudeln.jpg",
            "Tomatensuppe": "images/suppe.jpg",
            "Obstsalat": "images/obst.jpg",
            "Pancakes": "images/pancakes.jpg",
            "Avocado-Toast": "images/avocado.jpg",
            "Bananenshake": "images/smoothie.jpg",
            "Ofenkartoffel": "images/kartoffel.jpg"
        };

        async function updateImages() {
            const output = document.getElementById('output');
            output.textContent = 'Initialisiere Datenbank...\n';
            
            await initDatabase();
            output.textContent += 'Datenbank initialisiert\n\n';
            
            const recipes = getAllRecipes();
            output.textContent += `Gefunden: ${recipes.length} Rezepte\n\n`;
            
            let updated = 0;
            
            for (const recipe of recipes) {
                const imageUrl = imageMapping[recipe.title];
                
                if (imageUrl && !recipe.image_url) {
                    try {
                        db.run(
                            'UPDATE recipes SET image_url = ? WHERE id = ?',
                            [imageUrl, recipe.id]
                        );
                        output.textContent += `✓ "${recipe.title}" → ${imageUrl}\n`;
                        updated++;
                    } catch (error) {
                        output.textContent += `✗ Fehler bei "${recipe.title}": ${error}\n`;
                    }
                }
            }
            
            if (updated > 0) {
                saveDatabase();
                output.textContent += `\n${updated} Rezepte aktualisiert!\n`;
                output.textContent += '\nSeite wird neu geladen...';
                setTimeout(() => location.reload(), 2000);
            } else {
                output.textContent += '\nKeine Updates nötig.\n';
            }
        }
        
        function clearAndReload() {
            localStorage.removeItem('recipeDatabase');
            alert('LocalStorage gelöscht! Seite wird neu geladen.');
            location.reload();
        }
    </script>
</body>
</html>
