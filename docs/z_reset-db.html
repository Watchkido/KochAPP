<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Datenbank Reset</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/sql-wasm.js"></script>
    <script src="recipe-db.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 50px;
            max-width: 800px;
        }
        .btn { 
            padding: 15px 30px; 
            margin: 10px; 
            cursor: pointer;
            font-size: 16px;
            border-radius: 5px;
        }
        .primary { background: #007bff; color: white; border: none; }
        .danger { background: #dc3545; color: white; border: none; }
        .success { background: #28a745; color: white; border: none; }
        pre { 
            background: #f5f5f5; 
            padding: 15px; 
            border-radius: 5px; 
            max-height: 500px; 
            overflow: auto;
            font-size: 12px;
        }
        h1 { color: #333; }
        .warning {
            background: #fff3cd;
            border: 1px solid #ffc107;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ Datenbank komplett neu aufbauen</h1>
    
    <div class="warning">
        <strong>âš ï¸ Achtung:</strong> Dies lÃ¶scht ALLE vorhandenen Daten und erstellt die Datenbank komplett neu mit allen Demo-Rezepten und Bildern!
    </div>
    
    <div>
        <button class="btn danger" onclick="resetDatabase()">ğŸ—‘ï¸ Datenbank komplett neu aufbauen</button>
        <button class="btn primary" onclick="checkDatabase()">ğŸ” Datenbank prÃ¼fen</button>
        <button class="btn success" onclick="goToApp()">âœ… Zur App</button>
    </div>
    
    <pre id="output">Bereit...</pre>

    <script>
        async function resetDatabase() {
            const output = document.getElementById('output');
            output.textContent = 'ğŸ”„ LÃ¶sche LocalStorage...\n';
            
            // LocalStorage komplett lÃ¶schen
            localStorage.removeItem('recipeDatabase');
            output.textContent += 'âœ“ LocalStorage gelÃ¶scht\n\n';
            
            output.textContent += 'ğŸ”„ Initialisiere neue Datenbank...\n';
            
            // Datenbank neu initialisieren
            await initDatabase();
            output.textContent += 'âœ“ Datenbank initialisiert\n\n';
            
            // Rezepte prÃ¼fen
            const recipes = getAllRecipes();
            output.textContent += `ğŸ“Š Anzahl Rezepte: ${recipes.length}\n\n`;
            
            // Erste 5 Rezepte mit Details anzeigen
            output.textContent += 'ğŸ“‹ Erste 5 Rezepte:\n';
            output.textContent += 'â”'.repeat(60) + '\n';
            
            recipes.slice(0, 5).forEach((recipe, index) => {
                output.textContent += `\n${index + 1}. ${recipe.title}\n`;
                output.textContent += `   Kategorie: ${recipe.category}\n`;
                output.textContent += `   Kalorien: ${recipe.calories || 'keine Angabe'}\n`;
                output.textContent += `   Bild: ${recipe.image_url || 'KEIN BILD!'}\n`;
                output.textContent += `   Favorit: ${recipe.is_favorite ? 'Ja' : 'Nein'}\n`;
            });
            
            output.textContent += '\n' + 'â”'.repeat(60) + '\n';
            output.textContent += '\nâœ… Datenbank erfolgreich neu aufgebaut!\n';
            output.textContent += '\nâ¡ï¸ Klicke auf "Zur App" um die App zu Ã¶ffnen.\n';
        }
        
        async function checkDatabase() {
            const output = document.getElementById('output');
            output.textContent = 'ğŸ” PrÃ¼fe Datenbank...\n\n';
            
            await initDatabase();
            
            const recipes = getAllRecipes();
            output.textContent += `ğŸ“Š Anzahl Rezepte: ${recipes.length}\n\n`;
            
            // PrÃ¼fe wie viele Rezepte Bilder haben
            const recipesWithImages = recipes.filter(r => r.image_url);
            output.textContent += `ğŸ–¼ï¸ Rezepte mit Bildern: ${recipesWithImages.length}\n`;
            output.textContent += `ğŸ“· Rezepte ohne Bilder: ${recipes.length - recipesWithImages.length}\n\n`;
            
            // Zeige alle Rezepte
            output.textContent += 'ğŸ“‹ Alle Rezepte:\n';
            output.textContent += 'â”'.repeat(60) + '\n';
            
            recipes.forEach((recipe, index) => {
                const hasImage = recipe.image_url ? 'âœ“' : 'âœ—';
                output.textContent += `${index + 1}. ${hasImage} ${recipe.title} ${recipe.image_url ? `(${recipe.image_url})` : '(KEIN BILD)'}\n`;
            });
            
            output.textContent += 'â”'.repeat(60) + '\n';
            
            if (recipesWithImages.length === 0) {
                output.textContent += '\nâš ï¸ PROBLEM: Keine Rezepte haben Bilder!\n';
                output.textContent += 'ğŸ’¡ LÃ¶sung: Klicke auf "Datenbank komplett neu aufbauen"\n';
            }
        }
        
        function goToApp() {
            window.location.href = 'index.html';
        }
    </script>
</body>
</html>
